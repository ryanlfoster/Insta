#!/bin/bash
# chris.gerke@gmail.com

PROFILE="VPN"
DAEMON="AppleProfiles${PROFILE}"
ORG="cmg"

# Add for laptops
system_profiler SPHardwareDataType | grep "Model Identifier" | grep "Book"
if [ "$?" = "0" ]; then

 for REMOVE in `profiles -L | grep vpn | awk '{print $4}'`
 do
  echo "Removing ${REMOVE}"
  sudo profiles -R -p "${REMOVE}"
 done
 
 sleep 5
 
 for PROFILE in `ls "/usr/local/bin" | grep ".mobileconfig"`
 do
  echo "Adding ${p}"
  sudo profiles -I -F "/usr/local/bin/${PROFILE}"
  sudo rm -Rf "/usr/local/bin/${PROFILE}"
  sleep 1
 done
 
fi

# Clean
[ -e "/usr/local/bin/${PROFILE}.mobileconfig" ] && sudo rm -Rf "/usr/local/bin/${PROFILE}.mobileconfig"

# Unload
[ -e "/Library/LaunchDaemons/com.${ORG}.${DAEMON}.plist" ] && sudo srm "/Library/LaunchDaemons/com.${ORG}.${DAEMON}.plist"

# Self destruct
sudo srm "${0}"

exit 0