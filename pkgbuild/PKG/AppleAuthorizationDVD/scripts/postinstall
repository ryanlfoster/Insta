#!/bin/bash
# chris.gerke@gmail.com

ME=$0
OS=$(sudo defaults read "${ROOT}/System/Library/CoreServices/SystemVersion" ProductVersion)
ROOT="$3"; if [ -z "${ROOT}" ] || [ "${ROOT}" = "/" ]; then ROOT=""; fi
FDATE=$(date +"%Y%m%d%H%M%S")

# Detect Plistbuddy, it rocks.
[ -e /usr/libexec/PlistBuddy ] && PB="/usr/libexec/PlistBuddy" || exit 1

# Backup Original
[ -e "${ROOT}/etc/authorization" ] && sudo cp -f "${ROOT}/etc/authorization" "${ROOT}/etc/authorization.${FDATE}" || exit 1

# Allow DVD region setting rights
sudo "${PB}" -c "add rights:system.device.dvd.setregion.change dict" "${ROOT}/etc/authorization"
sudo "${PB}" -c "add rights:system.device.dvd.setregion.change:class string" "${ROOT}/etc/authorization"
sudo "${PB}" -c "set rights:system.device.dvd.setregion.change:class allow" "${ROOT}/etc/authorization"
sudo "${PB}" -c "delete rights:system.device.dvd.setregion.change:shared" "${ROOT}/etc/authorization"
sudo "${PB}" -c "delete rights:system.device.dvd.setregion.change:group" "${ROOT}/etc/authorization"

# Allow DVD region initial setting rights
sudo "${PB}" -c "set rights:system.device.dvd.setregion.initial:class allow" "${ROOT}/etc/authorization"
sudo "${PB}" -c "delete rights:system.device.dvd.setregion.initial:shared" "${ROOT}/etc/authorization"
sudo "${PB}" -c "delete rights:system.device.dvd.setregion.initial:group" "${ROOT}/etc/authorization"

# Permissions
sudo chown root:wheel "${ROOT}/etc/authorization"
sudo chmod 644 "${ROOT}/etc/authorization"

exit 0
